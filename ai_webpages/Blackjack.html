<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Blackjack Game</title>
    <style>
        :root {
            --primary-color: #227446;
            --secondary-color: #1b5e3a;
            --accent-color: #e4d9b2;
            --text-color: #ddd;
            --card-bg: #fff;
            --card-border: #ccc;
        }

        body {
            font-family: 'Arial', sans-serif;
            background-color: var(--primary-color);
            color: var(--text-color);
            margin: 0;
            padding: 0;
            display: flex;
            flex-direction: column;
            align-items: center;
            min-height: 100vh;
        }

        .header {
            width: 100%;
            background-color: var(--secondary-color);
            padding: 20px 0;
            text-align: center;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
        }

        h1 {
            margin: 0;
            text-transform: uppercase;
            letter-spacing: 2px;
            color: var(--accent-color);
        }

        .game-container {
            width: 90%;
            max-width: 900px;
            margin: 20px auto;
            padding: 20px;
            background-color: var(--secondary-color);
            border-radius: 10px;
            box-shadow: 0 6px 12px rgba(0, 0, 0, 0.3);
        }

        .settings {
            display: flex;
            justify-content: space-between;
            margin-bottom: 20px;
            padding: 10px;
            background-color: rgba(0, 0, 0, 0.2);
            border-radius: 5px;
        }

        .count-display {
            font-size: 18px;
            padding: 10px;
            background-color: rgba(0, 0, 0, 0.3);
            border-radius: 5px;
            display: flex;
            align-items: center;
        }

        .count-label {
            margin-right: 10px;
            font-weight: bold;
        }

        .count-value {
            font-size: 22px;
            color: var(--accent-color);
        }

        .controls {
            margin-bottom: 20px;
            text-align: center;
        }

        button {
            background-color: var(--accent-color);
            color: #333;
            border: none;
            padding: 10px 20px;
            margin: 0 5px;
            border-radius: 5px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        button:hover {
            background-color: #d9ca94;
            transform: translateY(-2px);
        }

        button:disabled {
            background-color: #888;
            cursor: not-allowed;
            transform: none;
        }

        .betting-controls {
            display: flex;
            justify-content: center;
            align-items: center;
            margin: 15px 0;
            flex-wrap: wrap;
        }

        .chip {
            width: 60px;
            height: 60px;
            display: flex;
            justify-content: center;
            align-items: center;
            border-radius: 50%;
            margin: 0 5px;
            font-weight: bold;
            cursor: pointer;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.2);
            transition: all 0.2s ease;
        }

        .chip:hover {
            transform: scale(1.1);
        }

        .chip-5 {
            background: linear-gradient(#e63946, #c1121f);
            border: 3px dashed white;
        }

        .chip-10 {
            background: linear-gradient(#2a9d8f, #1d7268);
            border: 3px dashed white;
        }

        .chip-25 {
            background: linear-gradient(#457b9d, #2c5282);
            border: 3px dashed white;
        }

        .chip-100 {
            background: linear-gradient(#6a0dad, #4b006f);
            border: 3px dashed white;
        }

        .players {
            display: flex;
            flex-direction: column;
            gap: 30px;
        }

        .player {
            padding: 15px;
            background-color: rgba(0, 0, 0, 0.2);
            border-radius: 8px;
        }

        .player-info {
            display: flex;
            justify-content: space-between;
            margin-bottom: 10px;
        }

        .player-name {
            font-size: 18px;
            font-weight: bold;
        }

        .player-score {
            font-size: 20px;
            font-weight: bold;
            color: var(--accent-color);
        }

        .cards-container {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
        }

        .card {
            width: 80px;
            height: 120px;
            background-color: var(--card-bg);
            border-radius: 5px;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            padding: 5px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
            position: relative;
            color: black;
        }

        .card.red {
            color: red;
        }

        .card-value {
            font-size: 20px;
            font-weight: bold;
        }

        .card-tl {
            text-align: left;
        }

        .card-br {
            text-align: right;
            transform: rotate(180deg);
        }

        .card-suit {
            font-size: 24px;
            text-align: center;
            flex-grow: 1;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .stats {
            display: flex;
            justify-content: space-between;
            margin-top: 20px;
            padding: 10px;
            background-color: rgba(0, 0, 0, 0.2);
            border-radius: 5px;
        }

        .chip-count, .bet-amount {
            font-size: 18px;
        }

        .value {
            font-weight: bold;
            color: var(--accent-color);
        }

        .deck-selector {
            display: flex;
            align-items: center;
        }

        .deck-selector label {
            margin-right: 10px;
        }

        select {
            padding: 5px 10px;
            border-radius: 5px;
            background-color: var(--accent-color);
            border: none;
        }

        .message {
            text-align: center;
            font-size: 20px;
            margin: 15px 0;
            min-height: 30px;
            color: var(--accent-color);
            font-weight: bold;
        }

        .hidden-card {
            background-color: #227446;
            background-image: linear-gradient(45deg, #1d5e3a 25%, transparent 25%, transparent 75%, #1d5e3a 75%, #1d5e3a), 
                              linear-gradient(45deg, #1d5e3a 25%, transparent 25%, transparent 75%, #1d5e3a 75%, #1d5e3a);
            background-size: 20px 20px;
            background-position: 0 0, 10px 10px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.4);
        }

        @media (max-width: 600px) {
            .settings {
                flex-direction: column;
                gap: 10px;
            }
            .card {
                width: 60px;
                height: 90px;
            }
            .chip {
                width: 50px;
                height: 50px;
                font-size: 14px;
            }
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>Blackjack</h1>
    </div>

    <div class="game-container">
        <div class="settings">
            <div class="deck-selector">
                <label for="deck-count">Number of Decks:</label>
                <select id="deck-count">
                    <option value="1">1</option>
                    <option value="2" selected>2</option>
                    <option value="4">4</option>
                    <option value="6">6</option>
                    <option value="8">8</option>
                </select>
            </div>
            <div class="count-display">
                <span class="count-label">Running Count:</span>
                <span class="count-value" id="card-count">0</span>
            </div>
        </div>

        <div class="stats">
            <div class="chip-count">Chips: <span class="value" id="chips">1000</span></div>
            <div class="bet-amount">Current Bet: <span class="value" id="bet">0</span></div>
        </div>

        <div class="betting-controls" id="betting-controls">
            <div class="chip chip-5" data-value="5">5</div>
            <div class="chip chip-10" data-value="10">10</div>
            <div class="chip chip-25" data-value="25">25</div>
            <div class="chip chip-100" data-value="100">100</div>
            <button id="clear-bet">Clear Bet</button>
            <button id="deal">Deal</button>
        </div>

        <div class="message" id="message"></div>

        <div class="controls" id="game-controls" style="display:none;">
            <button id="hit">Hit</button>
            <button id="stand">Stand</button>
            <button id="double">Double</button>
        </div>

        <div class="players">
            <div class="player" id="dealer">
                <div class="player-info">
                    <div class="player-name">Dealer</div>
                    <div class="player-score" id="dealer-score">0</div>
                </div>
                <div class="cards-container" id="dealer-cards"></div>
            </div>

            <div class="player" id="player">
                <div class="player-info">
                    <div class="player-name">Player</div>
                    <div class="player-score" id="player-score">0</div>
                </div>
                <div class="cards-container" id="player-cards"></div>
            </div>
        </div>

        <div class="controls" style="margin-top: 20px;">
            <button id="new-game">New Game</button>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // Card data - MOVED UP before functions that use them
            const suits = ['♥', '♦', '♠', '♣'];
            const values = ['A', '2', '3', '4', '5', '6', '7', '8', '9', '10', 'J', 'Q', 'K'];
            
            // Game state
            let deck = [];
            let dealerCards = [];
            let playerCards = [];
            let dealerScore = 0;
            let playerScore = 0;
            let currentBet = 0;
            let chips = 1000;
            let gameInProgress = false;
            let cardCount = 0;
            let dealerHiddenCard = null;

            // DOM elements
            const dealerCardsEl = document.getElementById('dealer-cards');
            const playerCardsEl = document.getElementById('player-cards');
            const dealerScoreEl = document.getElementById('dealer-score');
            const playerScoreEl = document.getElementById('player-score');
            const messageEl = document.getElementById('message');
            const chipsEl = document.getElementById('chips');
            const betEl = document.getElementById('bet');
            const cardCountEl = document.getElementById('card-count');
            const bettingControlsEl = document.getElementById('betting-controls');
            const gameControlsEl = document.getElementById('game-controls');
            const deckCountEl = document.getElementById('deck-count');

            // Buttons
            const hitBtn = document.getElementById('hit');
            const standBtn = document.getElementById('stand');
            const doubleBtn = document.getElementById('double');
            const dealBtn = document.getElementById('deal');
            const clearBetBtn = document.getElementById('clear-bet');
            const newGameBtn = document.getElementById('new-game');

            // Chip values
            const chipElements = document.querySelectorAll('.chip');

            // Initialize game
            initGame();

            // Event listeners
            hitBtn.addEventListener('click', hit);
            standBtn.addEventListener('click', stand);
            doubleBtn.addEventListener('click', doubleBet);
            dealBtn.addEventListener('click', startRound);
            clearBetBtn.addEventListener('click', clearBet);
            newGameBtn.addEventListener('click', newGame);
            deckCountEl.addEventListener('change', initGame);

            chipElements.forEach(chip => {
                chip.addEventListener('click', () => {
                    if (!gameInProgress) {
                        const value = parseInt(chip.getAttribute('data-value'));
                        if (chips >= value) {
                            currentBet += value;
                            chips -= value;
                            updateUI();
                        }
                    }
                });
            });

            // Functions
            function initGame() {
                dealerCards = [];
                playerCards = [];
                dealerScore = 0;
                playerScore = 0;
                currentBet = 0;
                gameInProgress = false;
                cardCount = 0;
                dealerHiddenCard = null;
                createDeck();
                updateUI();
                enableBetting();
                messageEl.textContent = "Place your bet to begin";
            }

            function createDeck() {
                deck = [];
                const numberOfDecks = parseInt(deckCountEl.value);
                
                for (let d = 0; d < numberOfDecks; d++) {
                    for (const suit of suits) {
                        for (const value of values) {
                            deck.push({
                                suit,
                                value,
                                numericValue: getCardValue(value)
                            });
                        }
                    }
                }
                
                shuffleDeck();
            }

            function shuffleDeck() {
                for (let i = deck.length - 1; i > 0; i--) {
                    const j = Math.floor(Math.random() * (i + 1));
                    [deck[i], deck[j]] = [deck[j], deck[i]];
                }
            }

            function drawCard(isHidden = false) {
                if (deck.length === 0) {
                    // If deck runs out, create and shuffle a new one
                    createDeck();
                }
                
                const card = deck.pop();
                
                // Update card count (card counting)
                if (!isHidden) {
                    updateCardCount(card.value);
                }
                
                return card;
            }

            function updateCardCount(cardValue) {
                // Hi-Lo card counting system
                if (['2', '3', '4', '5', '6'].includes(cardValue)) {
                    cardCount++;
                } else if (['10', 'J', 'Q', 'K', 'A'].includes(cardValue)) {
                    cardCount--;
                }
                // 7, 8, 9 are counted as 0 in Hi-Lo
                
                cardCountEl.textContent = cardCount;
            }

            function getCardValue(value) {
                if (value === 'A') return 11;
                if (['K', 'Q', 'J'].includes(value)) return 10;
                return parseInt(value);
            }

            function calculateScore(cards) {
                let score = 0;
                let aces = 0;
                
                for (const card of cards) {
                    score += card.numericValue;
                    if (card.value === 'A') {
                        aces++;
                    }
                }
                
                // Adjust for aces
                while (score > 21 && aces > 0) {
                    score -= 10;
                    aces--;
                }
                
                return score;
            }

            function renderCard(card, container, isHidden = false) {
                const cardElement = document.createElement('div');
                cardElement.className = 'card';
                
                if (isHidden) {
                    cardElement.className += ' hidden-card';
                    return cardElement;
                }
                
                if (card.suit === '♥' || card.suit === '♦') {
                    cardElement.className += ' red';
                }
                
                const topLeft = document.createElement('div');
                topLeft.className = 'card-value card-tl';
                topLeft.textContent = card.value;
                
                const bottomRight = document.createElement('div');
                bottomRight.className = 'card-value card-br';
                bottomRight.textContent = card.value;
                
                const suitElement = document.createElement('div');
                suitElement.className = 'card-suit';
                suitElement.textContent = card.suit;
                
                cardElement.appendChild(topLeft);
                cardElement.appendChild(suitElement);
                cardElement.appendChild(bottomRight);
                
                return cardElement;
            }

            function startRound() {
                if (currentBet <= 0) {
                    messageEl.textContent = "Please place a bet";
                    return;
                }
                
                gameInProgress = true;
                disableBetting();
                gameControlsEl.style.display = 'block';
                
                // Deal initial cards
                dealerCards = [drawCard()];
                dealerHiddenCard = drawCard(true);  // Hidden card
                playerCards = [drawCard(), drawCard()];
                
                dealerScore = calculateScore(dealerCards);
                playerScore = calculateScore(playerCards);
                
                renderCards();
                
                // Check for blackjack
                if (playerScore === 21) {
                    if (dealerCards[0].numericValue === 10 || dealerCards[0].value === 'A') {
                        // Check for dealer blackjack
                        revealDealerCard();
                        dealerScore = calculateScore(dealerCards);
                        
                        if (dealerScore === 21) {
                            endRound("Push! Both have Blackjack.");
                            chips += currentBet;
                        } else {
                            endRound("Blackjack! You win 3:2!");
                            chips += currentBet * 2.5;
                        }
                    } else {
                        endRound("Blackjack! You win 3:2!");
                        chips += currentBet * 2.5;
                    }
                } else if (dealerCards[0].value === 'A') {
                    // Offer insurance
                    messageEl.textContent = "Dealer shows Ace. Insurance?";
                    // For simplicity, we're not implementing insurance in this version
                }
                
                updateUI();
                checkDoubleOption();
            }

            function hit() {
                playerCards.push(drawCard());
                playerScore = calculateScore(playerCards);
                renderCards();
                
                if (playerScore > 21) {
                    endRound("Bust! You lose.");
                } else if (playerScore === 21) {
                    stand();
                }
                
                doubleBtn.disabled = true;
            }

            function stand() {
                revealDealerCard();
                dealerScore = calculateScore(dealerCards);
                renderCards();
                
                // Dealer draws until reaching 17 or higher
                setTimeout(() => {
                    dealerTurn();
                }, 500);
            }

            function dealerTurn() {
                if (dealerScore < 17) {
                    dealerCards.push(drawCard());
                    dealerScore = calculateScore(dealerCards);
                    renderCards();
                    
                    setTimeout(() => {
                        dealerTurn();
                    }, 500);
                } else {
                    determineWinner();
                }
            }

            function doubleBet() {
                // Check if player can afford to double
                if (chips >= currentBet) {
                    chips -= currentBet;
                    currentBet *= 2;
                    
                    // Draw one card and stand
                    playerCards.push(drawCard());
                    playerScore = calculateScore(playerCards);
                    renderCards();
                    
                    if (playerScore > 21) {
                        endRound("Bust! You lose.");
                    } else {
                        stand();
                    }
                    
                    updateUI();
                }
            }

            function determineWinner() {
                if (dealerScore > 21) {
                    endRound("Dealer busts! You win!");
                    chips += currentBet * 2;
                } else if (dealerScore > playerScore) {
                    endRound("Dealer wins!");
                } else if (dealerScore < playerScore) {
                    endRound("You win!");
                    chips += currentBet * 2;
                } else {
                    endRound("Push! It's a tie.");
                    chips += currentBet;
                }
            }

            function revealDealerCard() {
                dealerCards.push(dealerHiddenCard);
                updateCardCount(dealerHiddenCard.value);
                dealerHiddenCard = null;
            }

            function renderCards() {
                dealerCardsEl.innerHTML = '';
                playerCardsEl.innerHTML = '';
                
                // Render dealer cards
                for (const card of dealerCards) {
                    dealerCardsEl.appendChild(renderCard(card, dealerCardsEl));
                }
                
                if (dealerHiddenCard) {
                    dealerCardsEl.appendChild(renderCard(null, dealerCardsEl, true));
                }
                
                // Render player cards
                for (const card of playerCards) {
                    playerCardsEl.appendChild(renderCard(card, playerCardsEl));
                }
                
                dealerScoreEl.textContent = dealerHiddenCard ? '?' : dealerScore;
                playerScoreEl.textContent = playerScore;
            }

            function endRound(message) {
                messageEl.textContent = message;
                gameInProgress = false;
                disableGameControls();
                enableBetting();
                updateUI();
                
                // Check if player is out of chips
                if (chips <= 0) {
                    messageEl.textContent = "Game over! You're out of chips.";
                    disableBetting();
                }
            }

            function clearBet() {
                chips += currentBet;
                currentBet = 0;
                updateUI();
            }

            function newGame() {
                initGame();
            }

            function enableBetting() {
                bettingControlsEl.style.display = 'flex';
                gameControlsEl.style.display = 'none';
            }

            function disableBetting() {
                bettingControlsEl.style.display = 'none';
            }

            function disableGameControls() {
                gameControlsEl.style.display = 'none';
            }

            function checkDoubleOption() {
                // Can only double with first two cards and if you have enough chips
                doubleBtn.disabled = !(playerCards.length === 2 && chips >= currentBet);
            }

            function updateUI() {
                chipsEl.textContent = chips;
                betEl.textContent = currentBet;
            }
        });
    </script>
</body>
</html>